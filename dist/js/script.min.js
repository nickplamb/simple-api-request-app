let triviaSession=function(){let t=[],e=[],o=0,r=0,n="https://opentdb.com/api.php?encode=base64";const a=["category","type","difficulty","question","correct_answer","incorrect_answers"];function i(t,e,o){$(".modal .modal-title").text(t),$(".modal .modal-body").text(e),"optionError"===o?($("#dismissDialogButton").text("Try Again"),$("#restRoundButton").addClass("hidden")):($("#restRoundButton").removeClass("hidden"),$("#dismissDialogButton").text("Review Questions")),$("#notifyModal").modal("show")}function s(t){if("object"==typeof t){let e=[];return t.forEach(t=>{e.push(atob(t))}),e}return atob(t)}function c(){$(".card-container__row").remove(),t=[],o=0,r=0}return{fetchCategories:function(){return $.ajax("https://opentdb.com/api_category.php",{dataType:"json"}).then(t=>{t.trivia_categories.forEach(t=>{let o={id:t.id,name:t.name};e.push(o)}),function(){let t=$("#categories");e.forEach(e=>{let o=$(`<option value="${e.id}">${e.name}</option>`);t.append(o)})}()}).catch(t=>{console.error(t)})},prepareQuestionRetrieval:function(e){e.preventDefault(),c();let d=n,l=new Object;l.amount=$("#num-of-questions").val(),l.category=$("#categories").val(),l.difficulty=$("#difficulties").val(),l.type=$("#question-type").val(),Object.entries(l).forEach(t=>{""!==t[1]&&(d+=`&${t[0]}=${t[1]}`)}),function(e){$.ajax(e,{dataType:"json"}).then(e=>{if(0!==e.results.length)e.results.forEach(e=>{let o={category:s(e.category),type:s(e.type),difficulty:s(e.difficulty),question:s(e.question),correct_answer:s(e.correct_answer),incorrect_answers:s(e.incorrect_answers)};!function(e){"object"==typeof e?function(t,e){if(t.length!==e.length)return!1;for(let o=0;o<e.length;o++)if(t[o]!==e[o])return!1;return!0}(Object.keys(e),a)?t.push(e):console.error("Object does not have all required properties"):console.error("Not an object")}(o)});else{let t="No questions found.",e="Please change your options and try again.";i(t,e,"optionError")}!function(){let e=t,n=e.length;e.forEach((t,e)=>{!function(t,e,n){let a=$("#card-container"),s=t.incorrect_answers.slice();s.push(t.correct_answer);let c=$("<div></div").addClass("row justify-content-center card-container__row"),d=$("<div></div>").addClass("card-container__card col-11 col-sm-10 col-md-8 col-lg-7 col-xl-5 my-3"),l="question-"+(e+1),u=$("<div></div>").addClass("card card-inner bg-light "+l),p=$("<div></div>").addClass("card-front card-body bg-light"),f=$("<div></div>").addClass("card-header bg-warning mt-3"),h=$("<h4></h4>").addClass("card-title text-center").text(`Question ${e+1}:`),g=$("<p></p>").addClass("card-text").text(t.question),v=$("<div></div>").addClass("mt-4 answer-btns").attr("id","q-answers-"+(e+1)),y=$("<div></div>").addClass("card-back card-body bg-light "+l),m=$("<div></div>").addClass("mt-4"),b=$("<p></p>").addClass("card-text card-result "+l),w=$("<img>").addClass(l+" result-img");v.on("click","button",e=>(function(t,e,n,a){if(r++,t.target.innerText===e.correct_answer?(o++,$(`.card-result.${a}`).text(`The correct answer is: ${e.correct_answer}`),$(`img.${a}`).attr({src:"img/correct_icon.svg",alt:"Your answer was correct!"})):($(`.card-result.${a}`).text(`The correct answer is: ${e.correct_answer}`),$(`img.${a}`).attr({src:"img/wrong_icon.svg",alt:"Your answer was incorrect"})),r===n){let t="",e="";0===o?(t="You are not very good at this.",e="You didn't get any correct."):o<=.6*n?(t="Was that the best you could do?",e="You only got "+o+" out of "+n+"."):o===n?(t="Ok, maybe you are pretty smart.",e="You got a perfect score!"):(t="You did pretty well!",e="You got "+o+" out of "+n+"."),setTimeout(()=>{i(t,e,"endOfRound")},2e3)}$(".card-inner."+a).addClass("flip-over")})(e,t,n,l)),f.append(h,g),p.append(f.clone(),v),m.append(b,w),y.append(f.clone(),m),u.append(p,y),d.append(u),c.append(d),a.append(c);let _=[];s.forEach((t,o)=>{let r="btn-"+e+"-"+o,n=$("<button></button>").addClass("btn btn-outline-warning btn-block text-dark mt-3").attr("id",r).text(t).val(o+1);_.push(n)}),function(t){for(var e=t.length-1;e>0;e--){var o=Math.floor(Math.random()*(e+1)),r=t[e];t[e]=t[o],t[o]=r}}(_),_.forEach(t=>{v.append(t)})}(t,e,n)})}()}).catch(t=>{console.error(t)})}(d)},resetRound:c}}();triviaSession.fetchCategories(),$("#startForm").on("submit",t=>triviaSession.prepareQuestionRetrieval(t)),$("#restRoundButton").on("click",()=>triviaSession.resetRound());